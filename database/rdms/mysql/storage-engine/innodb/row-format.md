# Row Formats
- https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html

## 行格式
| 行格式类型 | 记录的额外信息 | 记录的真实数据 |
|--------|--------|--------|
| COMPACT | 变长字段长度列表 - NULL值列表 - 记录头信息 | 列1的值 - 列2的值 - ... - 列n的值 |
| DYNAMIC（5.7默认，与COMPACT基本类似，除了溢出页等不同） |  |  |


## 记录的真实数据
| 列名 | 是否必须 | 占用空间 | 描述 |
|--------|--------|--------|---|
| row_id | 否 | 6字节 | 行ID，唯一标志一条记录 |
| trx_id | 是 | 6字节 | 事务ID |
| roll_pointer | 是 | 7字节 | 回滚指针 |


## 数据页结构
### 简介

各个数据页可以组成一个双向链表，而每个数据页中的记录会按照主键值从小到大的顺序组成一个单向链表。每个数据页都会为存储在它里面的记录生成一个页目录，在通过主键查找某条记录的时候可以在页目录中使用二分查找快速定位到对应的槽，然后再遍历该槽对应分组中的记录即可快速找到指定的记录。

### 常用页类型

| 类型名称 | 描述 |
| --- | --- |
| FIL_PAGE_INDEX | 索引页，也叫数据页 |
| FIL_PAGE_TPYE_BLOB | 溢出页 |
| FIL_PAGE_UNDO_LOG | undo日志页 |
| FIL_PAGE_TYPE_TRX_SYS | 事务系统数据 |
| ... |  |

### 页大小

默认16KB

### 数据页的结构

**页头**

...

不同类型的页这部分结构不同

...

**页尾**

**其他**

由于表空间里面的页太多了，为了更好管理这些页（尽量让页的物理位置相邻，减少随机I/O）

将每64个页组成一个区，每256个区组成一个组

B+Tree 的叶子结点所在的页有独立的区

B+Tree的非叶子结点所在的页也有独立的区

存放叶子节点区的集合会生成一个段（segment），存放非叶子结点区的集合也会生成一个段（逻辑概念），也就是说一个索引会生成两个段：一个叶子节点段和一个非叶子结点段。

特殊区-碎片区

一些比较小的数据表由于数据少，会把多个小表的数据放在一个碎片区

上面这些概念都位于表空间中（表空间对应具体的某个真实文件）

独立表空间

系统表空间

### InnoDB数据页的7个组成部分

1. File Header
2. Page Header
3. Infimum + Supremum
4. User Records
5. Free Space
6. Page Directory
7. File Trailer
